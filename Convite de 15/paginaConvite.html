<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Convite - Debutante</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="paginaConvite.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>

<body>
  <button class="hero-edit-btn">Editar convite</button>

<!-- TUDO que queremos no PDF fica aqui --> -->
  <div id="convite">
    <header class="hero">
      <div class="hero-content">
        <h1 class="hero-title">NOME DA DEBUTANTE</h1>
        <p class="hero-subtitle">Venha comemorar meus 15 anos</p>
      </div>
    </header>

    <section class="local-section">
      <div class="local-image">
        <img src="image2.png" alt="Foto do sal√£o de festas">
      </div>

      <div class="local-text">
        <h2 class="section-title">Local</h2>
        <p>
          A festa ocorrer√° em um local muito especial! Essas informa√ß√µes foram definidas pela debutante üíñ
        </p>
      </div>
    </section>

    <section class="date-section">
      <div class="date-main">DATA</div>
      <div class="date-sub">HOR√ÅRIO</div>
    </section>
  </div>

  <!-- Form para confirma√ß√£o de presen√ßa que n√£o entra no PDF -->
  <section class="rsvp-section">
    <div class="rsvp-wrapper">
      <h2 class="rsvp-title">Confirme a sua presen√ßa</h2>

      <form id="rsvpForm">
        <div class="rsvp-form-group">
          <label class="rsvp-label" for="nome">Nome completo</label>
          <input class="rsvp-input" type="text" id="nome" placeholder="Insira aqui" required>
        </div>

        <div class="rsvp-form-group">
          <label class="rsvp-label" for="tipo">Adulto ou crian√ßa?</label>
          <input class="rsvp-input" type="text" id="tipo" placeholder="Insira aqui">
        </div>

        <div class="rsvp-form-group">
          <label class="rsvp-label" for="email">E-mail</label>
          <input class="rsvp-input" type="email" id="email" placeholder="seuemail@gmail.com" required>
        </div>

        <div class="rsvp-button-wrapper">
          <button type="submit" class="rsvp-button">Confirme sua presen√ßa!</button>
        </div>
      </form>
    </div>
  </section>

  <footer></footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Insere os dados salvos no convite 
      const infoRaw = localStorage.getItem('infoConvite');
      let info = {};

      if (infoRaw) {
        info = JSON.parse(infoRaw) || {};
      }

      const heroTitle = document.querySelector('.hero-title');
      if (heroTitle && info.name) {
        heroTitle.textContent = info.name;
      }

      const sectionTitle = document.querySelector('.section-title');
      if (sectionTitle && info.location) {
        sectionTitle.textContent = info.location;
      }

      const dateMain = document.querySelector('.date-main');
      if (dateMain && info.date) {
        dateMain.textContent = info.date;
      }

      const dateSub = document.querySelector('.date-sub');
      if (dateSub && info.time) {
        dateSub.textContent = info.time;
      }

      // Gerar PDF parecido com o convite
      const rsvpForm = document.getElementById('rsvpForm');

      if (rsvpForm) {
        rsvpForm.addEventListener('submit', function(e) {
          e.preventDefault();

          const guestName = document.getElementById('nome').value.trim();

          // Pega o elemento que representa o convite
          const conviteElement = document.getElementById('convite');

          if (!conviteElement) {
            alert('N√£o foi poss√≠vel encontrar o convite para gerar o PDF.');
            return;
          }

          const { jsPDF } = window.jspdf;

          // Usa html2canvas internamente para renderizar o HTML com CSS
          html2canvas(conviteElement, { scale: 2 }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');

            // A4 em pontos (pt): 595.28 x 841.89 (aprox.)
            const pdf = new jsPDF('p', 'pt', 'a4');

            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();

            const imgWidth = pageWidth;
            const imgHeight = canvas.height * imgWidth / canvas.width;

            let position = 0;
            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);

            const debutName = info.name || 'debutante';
            const safeDebutName = debutName.replace(/\s+/g, '_');
            const safeGuestName = (guestName || 'convidado').replace(/\s+/g, '_');

            pdf.save(`convite_${safeDebutName}_${safeGuestName}.pdf`);
          });
        });
      }
    });
  </script>
</body>
</html>